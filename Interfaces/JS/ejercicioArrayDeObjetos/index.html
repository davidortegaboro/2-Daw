<html>

</html>

<body>
    <h2>Arrays de Objetos</h2>

    <button onclick="notasAlumno()">Notas de un alumno</button><br>
    <p>

        <button onclick="subeUnPunto()">Subir un punto en cada asignatura</button><br>
    <p>

        <button onclick="alumnosCiudad()">Buscar alumnos de una ciudad</button>
        <button onclick="alumnosCurso()">Buscar alumnos de un curso</button><br>
    <p>

        <button onclick="ordenaEdad()">Ordenar alumnos por edad</button>
        <button onclick="ordenaNombreAsc()">Ordenar alumnos por nombre ascendente</button>
        <button onclick="ordenaNombreDesc()">Ordenar alumnos por nombre descendente</button><br>
    <p>

        <button onclick="borraAlumno()">Borrar alumno</button><br>
    <p>

        <button onclick="nuevoAlumno()">Nuevo alumno</button>
        <button onclick="nuevaAsignatura()">Nueva asignatura</button>

</body>

<script>
    "use strict"
    let alumnos = [{
        'codigo': 'DAW-1-2020',
        'nombre': 'pepe',
        'ciudad': 'Valencia',
        'calificaciones': [{ 'asignatura': 'PRG', 'nota': 9 },
        { 'asignatura': 'GBD', 'nota': 6 },
        { 'asignatura': 'ING', 'nota': 4 },
        { 'asignatura': 'FOL', 'nota': 3 }
        ],
        'edad': 24
    },
    {
        'codigo': 'DAW-2-2020',
        'nombre': 'juan',
        'ciudad': 'Castellon',
        'calificaciones': [{ 'asignatura': 'DWC', 'nota': 4 },
        { 'asignatura': 'DWS', 'nota': 6 },
        { 'asignatura': 'DAW', 'nota': 7 },
        { 'asignatura': 'DIW', 'nota': 8 },
        { 'asignatura': 'ING', 'nota': 9 },
        { 'asignatura': 'EIE', 'nota': 2 }
        ],
        'edad': 28
    },
    {
        'codigo': 'DAW-1-2019',
        'nombre': 'ana',
        'ciudad': 'Valencia',
        'calificaciones': [{ 'asignatura': 'PRG', 'nota': 6 },
        { 'asignatura': 'GBD', 'nota': 2 },
        { 'asignatura': 'ING', 'nota': 6 },
        { 'asignatura': 'FOL', 'nota': 2 }
        ],
        'edad': 22
    },
    {
        'codigo': 'DAW-2-2020',
        'nombre': 'maria',
        'ciudad': 'Castellon',
        'calificaciones': [{ 'asignatura': 'DWC', 'nota': 4 },
        { 'asignatura': 'DWS', 'nota': 6 },
        { 'asignatura': 'DAW', 'nota': 7 },
        { 'asignatura': 'DIW', 'nota': 8 },
        { 'asignatura': 'ING', 'nota': 4 },
        { 'asignatura': 'EIE', 'nota': 1 }
        ],
        'edad': 30
    }
    ]

    function notasAlumno() {
        // Solicitar el nombre del alumno al usuario mediante un cuadro de diálogo
        let nombreAlumno = prompt("Inserte el nombre del alumno");

        // Formatear el nombre del alumno: convertir a minúsculas y eliminar espacios en blanco
        let nombreAlumnoFormateado = nombreAlumno.toLowerCase().trim();

        // Buscar el objeto del alumno en el array 'alumnos' utilizando el método find
        let al = alumnos.find(alumno => alumno.nombre.toLowerCase().trim() === nombreAlumnoFormateado);

        // Verificar si se encontró al alumno
        if (al) {
            // Inicializar variables para calcular la media, mayor y menor nota
            let notaMediaAlumno = 0; // Suma de todas las notas para calcular la media
            let nombreAsignaturaMayor = ""; // Para guardar el nombre de la asignatura con la mayor nota
            let notaMayor = 0; // Inicializa la mayor nota en 0
            let nombreAsignaturaMenor = ""; // Para guardar el nombre de la asignatura con la menor nota
            let notaMenor = 10; // Inicializa la menor nota en 10 (suponiendo que las notas están entre 0 y 10)

            // Recorrer cada calificación del alumno
            al.calificaciones.forEach(calificacion => {
                notaMediaAlumno += calificacion.nota; // Sumar la nota actual a la nota media

                // Comprobar si la nota actual es menor que la menor nota registrada
                if (calificacion.nota <= notaMenor) {
                    notaMenor = calificacion.nota; // Actualizar la menor nota
                    nombreAsignaturaMenor = calificacion.asignatura; // Guardar el nombre de la asignatura correspondiente
                }

                // Comprobar si la nota actual es mayor que la mayor nota registrada
                if (calificacion.nota >= notaMayor) {
                    notaMayor = calificacion.nota; // Actualizar la mayor nota
                    nombreAsignaturaMayor = calificacion.asignatura; // Guardar el nombre de la asignatura correspondiente
                }
            });

            // Calcular la media dividiendo la suma total de notas por la cantidad de calificaciones
            notaMediaAlumno = notaMediaAlumno / al.calificaciones.length;

            // Mostrar los resultados en la consola
            console.log(`La nota media de: ${nombreAlumnoFormateado} es: ${notaMediaAlumno}`);
            console.log(`La nota mayor de: ${nombreAlumnoFormateado} es: ${notaMayor} en ${nombreAsignaturaMayor}`);
            console.log(`La nota menor de: ${nombreAlumnoFormateado} es: ${notaMenor} en ${nombreAsignaturaMenor}`);

        } else {
            // Mensaje de error si no se encuentra al alumno
            console.log("Nombre de alumno no encontrado");
        }
    }

    function subeUnPunto() {
        alumnos.forEach(alumno => {
            // Actualiza las calificaciones sumando 1 a cada nota, manteniendo la estructura
            alumno.calificaciones = alumno.calificaciones.map(calificacion => ({
                asignatura: calificacion.asignatura,
                nota: calificacion.nota + 1 // Sumar 1 a la nota
            }));
        });
    }

    function alumnosCiudad() {

        let nombreCiudad = prompt("Inserte el nombre de una ciudad");

        if (nombreCiudad.trim() !== "") {

            let nombreCiudadFormateado = nombreCiudad.trim();

            let alumnosMismaCiudad = [];

            alumnos.forEach(alumno => {
                if (alumno.ciudad.toLowerCase() === nombreCiudadFormateado.toLowerCase()) {
                    alumnosMismaCiudad.push(alumno.nombre);
                }
            });

            if (alumnosMismaCiudad.length === 0) {
                console.log("Ha habido un error, no se ha encontrado ningun alumno con esa ciudad");
            } else {
                console.log(alumnosMismaCiudad);
            }
        } else {
            console.log("Inserte un dato valido");
        }
    }

    function alumnosCurso() {
        let cursoAlumno = prompt("Inserte el numero de un curso");

        if (cursoAlumno.trim() === "") {
            console.log("Inserte un curso, no has escrito ninguno");
        } else {

            let cursoAlumnoFormateado = cursoAlumno.trim();

            let cursoAlumnosMismoCurso = [];

            let cursoAlumnoDividido;

            alumnos.forEach(alumno => {

                cursoAlumnoDividido = alumno.codigo.split("-");

                if (cursoAlumnoDividido[1] === cursoAlumnoFormateado) {
                    cursoAlumnosMismoCurso.push(alumno.nombre);
                }
            })

            if (cursoAlumnosMismoCurso.length === 0) {
                console.log("No hay ningun alumno con ese curso");
            } else {
                console.log(cursoAlumnosMismoCurso);
            }
        }
    }

    function ordenaEdad() {

        let alumnosOrdenadosPorEdad = alumnos.sort((a, b) => a.edad - b.edad);

        let nombreYCurosAlumnos = [];

        alumnosOrdenadosPorEdad.forEach(alumno => {
            nombreYCurosAlumnos.push(alumno.nombre, alumno.edad);
        });

        console.log(nombreYCurosAlumnos);
    }


    function ordenaNombreAsc() {
        // Inicializa nombreAlumnos como un array vacío
        let nombreAlumnos = [];

        // Utiliza forEach para llenar el array con los nombres
        alumnos.forEach(alumno => {
            nombreAlumnos.push(alumno.nombre);
        });

        // Ordena el array de nombres alfabéticamente
        let nombreAlumnosOrdenados = nombreAlumnos.sort();

        // Muestra el array ordenado en consola
        console.log(nombreAlumnosOrdenados);
    }

    function ordenaNombreDesc() {
        // Inicializa nombreAlumnos como un array vacío
        let nombreAlumnos = [];

        // Utiliza forEach para llenar el array con los nombres
        alumnos.forEach(alumno => {
            nombreAlumnos.push(alumno.nombre);
        });

        // Ordena el array de nombres alfabéticamente y con reverse le da la vuelta
        let nombreAlumnosOrdenados = nombreAlumnos.sort().reverse();

        // Muestra el array ordenado en consola
        console.log(nombreAlumnosOrdenados);
    }

    function borraAlumno() {
        // Solicitar el nombre del alumno al usuario mediante un cuadro de diálogo
        let nombreAlumno = prompt("Inserte el nombre del alumno");

        // Formatear el nombre del alumno: convertir a minúsculas y eliminar espacios en blanco
        let nombreAlumnoFormateado = nombreAlumno.toLowerCase().trim();

        // Buscar el indice del alumno en el array 'alumnos' utilizando el método findIndex
        let al = alumnos.findIndex(alumno => alumno.nombre.toLowerCase().trim() === nombreAlumnoFormateado);

        if (al >= 0) {
            alumnos.splice(al, 1);
        } else {
            console.log("No se ha encontrado ningun alumno");
        }
    }

    function nuevoAlumno() {

        let codigo = prompt("Inserte el codigo del alumno");
        let nombre = prompt("Inserte el nombre del alumno");
        let ciudad = prompt("Inserte la ciudad del alumno");
        let edad = prompt("Inserte la edad del alumno");

        let nuevoAlumno = {
            codigo: codigo.trim(),
            nombre: nombre.trim(),
            ciudad: ciudad.trim(),
            edad: edad.trim(),
            calificaciones: []
        };

        alumnos.push(nuevoAlumno);

        console.log(alumnos);

    }




</script>

</html>